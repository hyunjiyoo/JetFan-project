<link rel="stylesheet" href="{{ url_for('static', filename='css/dist/trace.css') }}">

{% include 'header.html' %}
    
<div class="content-body">
    <h3>JetFan 추적도면 관리</h3>

    <!-- <meta id='my-data' data-branch='{{ branch }}'> -->

    <div id='body-header'>
        <div>
            <select name="dept" id="dept" onchange='getDeptCode()'>
                <option value=" 0">본부</option>
                {% for dept in data['dept'] %}
                <option value=" {{ dept['div_code'] }}">
                    {{ dept['div_name'] }}
                </option>
                {% endfor %}
            </select>
            
            <select name="branch" id="branch">
                <option value="">지사</option>
            </select>


            <select name="tunnel" id="tunnel" onchange='setTunnel()'>
                {% for tunnel in data['tunnel'] %}
                <option name='tunn_name' value="{{ tunnel['tunn_name'] }}">
                    {{ tunnel['tunn_name'] }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div>
            <select name="" id="select_jetfan_way" onchange='setJetfanWay()'>
                {% for jetfan in data['jetfan'] %}
                    <option name='jetfan_way' value="{{ jetfan['jetfan_way'] }}">
                        {{ jetfan['jetfan_way'] }}
                    </option>
                {% endfor %}
            </select>

            <select name="" id="">
                {% for jetfan in data['jetfan'] %}
                    <option name='jetfan_lane' value="{{ jetfan['jetfan_lane'] }}">
                        {{ jetfan['jetfan_lane'] }}
                    </option>
                {% endfor %}
            </select>

            <select name="" id="">
                <option value="">101</option>
                <option value="">101</option>
                <option value="">101</option>
            </select>
        </div>
        <div>
            <select name="" id="">
                <option value="">2020</option>
            </select>
        </div>
    </div>

    <div id="contents">
        <div id="history">
            <table>
                <tr>
                    <td colspan='4' class='table-header'>시설이력</td>
                </tr>
                <tr>
                    <td class='table-title'>터널명</td>
                    <td id='tunn_name'></td>
                    <td class='table-title'>방향</td>
                    <td id='jetfan_way'></td>
                </tr>
                <tr>
                    <td class='table-title'>차선</td>
                    <td>A</td>
                    <td class='table-title'>관리번호</td>
                    <td>109</td>
                </tr>
                <tr>
                    <td colspan='1' class='table-title'>제조사</td>
                    <td colspan='3'>에스텍이앤지(주)</td>
                </tr>
                <tr>
                    <td colspan='1' class='table-title'>점검자</td>
                    <td colspan='3'>손정화(개인)</td>
                </tr>
                <tr>
                    <td colspan='1' class='table-title'>점검일자</td>
                    <td colspan='3'>2019.06.24</td>
                </tr>
            </table>

            <div id='planImg'>
                <img src="http://via.placeholder.com/100x100" alt="planning_image">
            </div>
        </div>

        <div id="operationChk">
            <table>
                <tr>
                    <td colspan='5' class='table-header'>운전점검</td>
                </tr>
                <tr>
                    <td rowspan='5' colspan='1' class='table-title'>진동<br>(K.S 기준 6mm/sec이하)</td>
                    <td colspan='4' class='table-title'>턴버클 & FAN 안정판 체결부위<br>(대당 2Point)</td>
                </tr>
                <tr>
                    <td rowspan='2' class='table-title'>구분</td>
                    <td class='table-title'>Vertical</td>
                    <td class='table-title'>Horizontal</td>
                    <td class='table-title'>Axial</td>
                </tr>
                <tr>
                    <td class='table-title'>수직방향</td>
                    <td class='table-title'>수평방향</td>
                    <td class='table-title'>축방향</td>
                </tr>
                <tr>
                    <td class='table-title'>①</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td class='table-title'>②</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td class='table-title'>운전 전류</td>
                    <td class='table-title'>구분</td>
                    <td class='table-title'>R</td>
                    <td class='table-title'>S</td>
                    <td class='table-title'>T</td>
                </tr>
                <tr>
                    <td class='table-title'>(A)</td>
                    <td class='table-title'>측정값</td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan='2' class='table-title'>전압(V)</td>
                    <td colspan='3'></td>
                </tr>

            </table>
        </div>

        <div id="curStatusChk">
            <table>
                <tr>
                    <td class='table-header'>현상태점검현황</td>
                </tr>
                <!-- <tr><td>- <input type="text" name="" id="" maxlength="40"></td></tr> -->
                <!-- <tr><td>- <input type="text" name="" id="" maxlength="40"></td></tr>
                <tr><td>- <input type="text" name="" id="" maxlength="40"></td></tr>
                <tr><td>- <input type="text" name="" id="" maxlength="40"></td></tr>
                <tr><td>- <input type="text" name="" id="" maxlength="40"></td></tr>
                <tr><td>- <input type="text" name="" id="" maxlength="40"></td></tr>
                <tr><td>- <input type="text" name="" id="" maxlength="40"></td></tr>
                <tr><td>- <input type="text" name="" id="" maxlength="40"></td></tr> -->
            </table>
        </div>

        <div id='etc'>
            <table>
                <tr>
                    <td class='table-header'>비고(기능상태 등)</td>
                </tr>
                <tr><td class='table-title'>2019년도</td></tr>
                <!-- <tr><td>1) <input type="text" name="" id="" maxlength="28"></td></tr>
                <tr><td>2) <input type="text" name="" id="" maxlength="28"></td></tr>
                <tr><td>3) <input type="text" name="" id="" maxlength="28"></td></tr>
                <tr><td>4) <input type="text" name="" id="" maxlength="28"></td></tr>
                <tr><td>5) <input type="text" name="" id="" maxlength="28"></td></tr>
                <tr><td>6) <input type="text" name="" id="" maxlength="28"></td></tr> -->

                <tr><td class='table-title'>2018년도</td></tr>
                <tr><td>1)</td></tr>
                <tr><td>2)</td></tr>
                <tr><td>3)</td></tr>
                <tr><td>4)</td></tr>
                <tr><td>5)</td></tr>

                <tr><td class='table-title'>2017년도</td></tr>
                <tr><td>1)</td></tr>
                <tr><td>2)</td></tr>
                <tr><td>3)</td></tr>
                <tr><td>4)</td></tr>
                <tr><td>5)</td></tr>
            </table>
        </div>
    </div>
</div>

{% include 'footer.html' %}
<script>

const getDeptCode = () => {
    const div_code = document.querySelector('#dept').value;
    
    console.log('div_code :>> ', div_code);
    
    const opt_len = document.querySelectorAll('#branch option').length;
    if(opt_len > 1) {
        for(let i = opt_len-1; i > 0; i--) {
            document.querySelectorAll('#branch option')[i].remove();
        }
    }

    const data = { 'div_code': div_code };
    const xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            let data = this.responseText;
            let branch = data.slice(1,-1).split(',');

            console.log('data :>> ', data);
            
            for(let j = 0; j < branch.length; j++) {
                let opt = document.createElement('option');
                document.querySelector('#branch').appendChild(opt);
                opt.innerText = branch[j].trim().slice(1, -1);
            }
        }
    };
    xhttp.open("POST", "./trace", true);
    xhttp.setRequestHeader('Content-Type', 'application/json');
    xhttp.send(JSON.stringify(data));
}




const setTunnel = () => {
    const tunn_name = document.querySelector('#tunnel').value;
    document.querySelector('#tunn_name').innerText = tunn_name + '터널';
}

const setJetfanWay = () => {
    const jetfan_way = document.querySelector('#select_jetfan_way').value;
    document.querySelector('#jetfan_way').innerText = jetfan_way;
}




</script>